name: Chocolatine
 
on:
  push:
    branches-ignore:
      - ga-ignore-*
  pull_request:
     branches-ignore:
      - ga-ignore-*
jobs:
  check_coding_style:
    name: coding_style
    runs-on: Ubuntu-latest
    container: ghcr.io/epitech/coding-style-checker:latest
    steps:
      - name: get code
        uses: actions/checkout@v4
 
      - name: checker
        run: check.sh $(pwd) $(pwd)
 
      - name: display error
        run: |
          if [ -f coding-style-reports.log]; then
            while read -r line; do
              echo "::error file=$(echo $line | cut -d' : ' -f1), lines=$(echo $line | cut -d':' -f2)::$line"
           done < coding-style-reports.log
          fi
 
  Checking_that_the_program_compiles:
    name: Compilation
    runs-on: Ubuntu-latest
    container: epitechcontent/epitest-docker
    needs: check_coding_style
    steps:
      - name: code
        uses: actions/checkout@v4
 
      - name: compiler
        run: timeout 120s make
 
      - name: nettoyer
        run: make clean
 
  Run_tests:
    name: runnig
    runs-on: Unbutu-latest
    container: epitechcontent/epitest-docker
    needs: Checking_that_the_program_compiles
    steps:
      - name: code
        uses: actions/checkout@v4
 
      - name: compiler
        run: timeout 120s make tests_run
 
  Pushing_to_the_mirror_repository:
    name: pushing
    runs-on: Ubuntu-latest
    steps:
      - name: code
        uses: actions/checkout@v4
 
      - name:
        run: |
          mkdir -p ~/.ssh
          echo "${{ secrets.GIT_SSH_PRIVATE_KEY }}" > ~/.ssh/id_rsa
          chmod 600 ~/.ssh/id_rsa